

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Leaspy Utilisation &#8212; Disease Progression Modelling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom_css.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/js/custom_js.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'pages/notebooks/disease_course_mapping/TP3_advanced_leaspy';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="GP Progression Model" href="../non_parametric_DPM/non_parametric_DPM.html" />
    <link rel="prev" title="First steps with Leaspy" href="TP2_leaspy_beginner.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../main.html">
  
  
  
  
  
    <p class="title logo__title">Disease Progression Modelling</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../main.html">
                    Disease Progression Modelling
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../models/introduction.html">Introduction to DPM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/event_based_model.html">Event Based Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/disease_course_mapping.html">Disease Course Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/non_parametric_DPM.html">GP Progression Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models/SuStaIn.html">SuStaIn</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebooks</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ebm/ebm.html">Disease Course Sequencing with the Event Based Model</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ebm/T1_kde_ebm_walkthrough.html">Tutorial 1 - EBM Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ebm/T2_pyEBM_walkthrough.html">Tutorial 2 - DEBM Walkthrough</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="disease_course_mapping.html">Disease Course Mapping with Leaspy</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="TP1_LMM.html">Tutorial 1 - Linear Mixed Effect Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="TP2_leaspy_beginner.html">Tutorial 2 - Get ready with Leaspy</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Tutorial 3 - Leaspy advanced</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../non_parametric_DPM/non_parametric_DPM.html">GP Progression Model</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../non_parametric_DPM/GPPM_basic.html">Tutorial 1 - GP Progression Model Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../non_parametric_DPM/GPPM_DS.html">Tutorial 2 - GP Progression Model with Dynamical Systems Walkthrough</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../sustain/sustain.html">Disease Course Sequence Subtyping with Subtype and Stage Inference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../sustain/T1_sustain_walkthrough.html">Tutorial 1 - SuStaIn Walkthrough</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Conferences</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../conferences/conferences.html">Conferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conferences/MICCAI.html">MICCAI 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conferences/ISBI.html">ISBI 2021</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../other/contributors.html">Contributors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/Disease-Progression-Modelling/disease-progression-modelling.github.io/blob/master/pages/notebooks/disease_course_mapping/TP3_advanced_leaspy.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/edit/master/pages/notebooks/disease_course_mapping/TP3_advanced_leaspy.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Disease-Progression-Modelling/disease-progression-modelling.github.io/issues/new?title=Issue%20on%20page%20%2Fpages/notebooks/disease_course_mapping/TP3_advanced_leaspy.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/pages/notebooks/disease_course_mapping/TP3_advanced_leaspy.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Advanced Leaspy Utilisation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">Objectives :</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-set-up">The set-up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-i-the-prediction">Part I: The prediction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-1-prepare-your-data">I.1. Prepare your data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-2-train-your-model">I.2. Train your model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-3-test-your-model">I.3. Test your model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-ii-the-cofactor-evaluation">Part II: The cofactor evaluation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-iii-univariate-vs-multivariate">Part III: Univariate vs Multivariate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-iv-get-the-best-model-as-you-can">Part IV: Get the best model as you can</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="advanced-leaspy-utilisation">
<h1>Advanced Leaspy Utilisation<a class="headerlink" href="#advanced-leaspy-utilisation" title="Permalink to this heading">#</a></h1>
<p>This is already the last practical session of the day ! Be carefull you only have an <strong>hour and a half</strong>.</p>
<div class="section" id="objectives">
<h2>Objectives :<a class="headerlink" href="#objectives" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Understand data format that is needed to use Leaspy,</p></li>
<li><p>Learn to use parameters</p></li>
<li><p>Explore models selection</p></li>
</ul>
</div>
<div class="section" id="the-set-up">
<h2>The set-up<a class="headerlink" href="#the-set-up" title="Permalink to this heading">#</a></h2>
<p>As before, if you have followed the <a class="reference external" href="https://gitlab.com/icm-institute/aramislab/disease-course-mapping-solutions">installation details</a> carefully, you should</p>
<ul class="simple">
<li><p>be running this notebook in the <code class="docutils literal notranslate"><span class="pre">leaspy_tutorial</span></code> virtual environment</p></li>
<li><p>having all the needed packages already installed</p></li>
</ul>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 1 ğŸ’¬</span> <strong>Run the following command lines.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">leaspy</span> <span class="kn">import</span> <span class="n">Leaspy</span><span class="p">,</span> <span class="n">IndividualParameters</span><span class="p">,</span> <span class="n">AlgorithmSettings</span><span class="p">,</span> <span class="n">Data</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="part-i-the-prediction">
<h2>Part I: The prediction<a class="headerlink" href="#part-i-the-prediction" title="Permalink to this heading">#</a></h2>
<p>One of the main issue of Parkinson disease specialized doctor is that they do not know how fast will the disease evolved and then are unable to set the right spacing between two visits wih their patients. In addition, they would like to give advises to their patients for them to anticipate administrative obligations by the time they are still able to do them. The most important score to monitore is MDS3_off_total, but it is always nice to have a some others.</p>
<p>Leaspy could be a great tool to help solving those issues. The following part contains the main structure to train and test a leaspy model.</p>
<div class="section" id="i-1-prepare-your-data">
<h3>I.1. Prepare your data<a class="headerlink" href="#i-1-prepare-your-data" title="Permalink to this heading">#</a></h3>
<p><span style='color: #015e75; font-weight: 600;'>â„¹ï¸ Information â„¹ï¸</span> Two datasets, containing 200 patients, are available :</p>
<ul class="simple">
<li><p><strong>learn_leaspy2</strong> : contains historic data of patients visits,</p></li>
<li><p><strong>pred_leaspy2</strong> : contains the next visit for each patient, that it would be nice to predict.</p></li>
</ul>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 2 ğŸ’¬</span> <strong>Run the following command lines to load the data.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;data/TP3_advanced_leaspy/&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;learn_leaspy2.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>MDS1_total</th>
      <th>MDS2_total</th>
      <th>MDS3_off_total</th>
      <th>SCOPA_total</th>
      <th>MOCA_total</th>
      <th>PUTAMEN_R</th>
      <th>PUTAMEN_L</th>
      <th>CAUDATE_R</th>
      <th>CAUDATE_L</th>
      <th>AGD_total</th>
    </tr>
    <tr>
      <th>ID</th>
      <th>TIME</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">GS-001</th>
      <th>62.289333</th>
      <td>NaN</td>
      <td>3.556297</td>
      <td>-9.000000</td>
      <td>0.000000</td>
      <td>26.784926</td>
      <td>0.168703</td>
      <td>0.140237</td>
      <td>0.069723</td>
      <td>0.041532</td>
      <td>0.078704</td>
    </tr>
    <tr>
      <th>62.789333</th>
      <td>4.644412</td>
      <td>6.570468</td>
      <td>15.658805</td>
      <td>5.721043</td>
      <td>25.303684</td>
      <td>0.146405</td>
      <td>0.172067</td>
      <td>0.034234</td>
      <td>0.089805</td>
      <td>0.374873</td>
    </tr>
    <tr>
      <th>63.289333</th>
      <td>1.955755</td>
      <td>2.621946</td>
      <td>29.142870</td>
      <td>0.000000</td>
      <td>30.000000</td>
      <td>0.163331</td>
      <td>0.188258</td>
      <td>0.069586</td>
      <td>0.060110</td>
      <td>0.194420</td>
    </tr>
    <tr>
      <th>64.289330</th>
      <td>NaN</td>
      <td>0.000000</td>
      <td>44.319816</td>
      <td>44.560006</td>
      <td>29.851244</td>
      <td>0.185705</td>
      <td>0.177019</td>
      <td>0.053399</td>
      <td>0.076220</td>
      <td>0.237782</td>
    </tr>
    <tr>
      <th>64.789330</th>
      <td>4.169568</td>
      <td>4.752366</td>
      <td>29.652244</td>
      <td>0.000000</td>
      <td>28.533121</td>
      <td>0.194951</td>
      <td>0.171595</td>
      <td>0.048021</td>
      <td>0.083921</td>
      <td>0.159916</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_vis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;pred_leaspy2.csv&quot;</span><span class="p">)</span>
<span class="n">df_vis</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ID&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_vis</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TIME</th>
      <th>MDS1_total</th>
      <th>MDS2_total</th>
      <th>MDS3_off_total</th>
      <th>SCOPA_total</th>
      <th>MOCA_total</th>
      <th>PUTAMEN_R</th>
      <th>PUTAMEN_L</th>
      <th>CAUDATE_R</th>
      <th>CAUDATE_L</th>
      <th>AGD_total</th>
    </tr>
    <tr>
      <th>ID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GS-001</th>
      <td>69.089333</td>
      <td>4.960370</td>
      <td>5.635592</td>
      <td>45.674665</td>
      <td>13.727753</td>
      <td>27.915718</td>
      <td>0.209688</td>
      <td>0.229443</td>
      <td>0.105179</td>
      <td>0.137542</td>
      <td>0.319582</td>
    </tr>
    <tr>
      <th>GS-002</th>
      <td>73.647736</td>
      <td>14.674264</td>
      <td>9.983259</td>
      <td>48.461299</td>
      <td>1.777607</td>
      <td>19.778270</td>
      <td>0.268539</td>
      <td>0.211596</td>
      <td>0.196772</td>
      <td>0.193251</td>
      <td>0.404642</td>
    </tr>
    <tr>
      <th>GS-003</th>
      <td>62.491299</td>
      <td>NaN</td>
      <td>9.429927</td>
      <td>-9.000000</td>
      <td>27.019072</td>
      <td>24.602786</td>
      <td>0.182493</td>
      <td>0.151622</td>
      <td>0.056601</td>
      <td>0.096034</td>
      <td>0.347589</td>
    </tr>
    <tr>
      <th>GS-004</th>
      <td>67.666000</td>
      <td>7.170177</td>
      <td>3.978171</td>
      <td>7.608285</td>
      <td>0.000000</td>
      <td>27.879789</td>
      <td>0.223414</td>
      <td>0.185168</td>
      <td>0.186051</td>
      <td>0.182661</td>
      <td>0.312880</td>
    </tr>
    <tr>
      <th>GS-005</th>
      <td>74.125290</td>
      <td>NaN</td>
      <td>3.628875</td>
      <td>-9.000000</td>
      <td>3.493040</td>
      <td>28.498334</td>
      <td>0.197911</td>
      <td>0.189411</td>
      <td>0.114025</td>
      <td>0.122356</td>
      <td>0.336951</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><span style='color: #015e75; font-weight: 600;'>â„¹ï¸ Information â„¹ï¸</span> You have the following informations about scores :</p>
<ul class="simple">
<li><p><strong>MDS1_total</strong> : increasing score from 0 to 52,</p></li>
<li><p><strong>MDS2_total</strong> : increasing score from 0 to 52,</p></li>
<li><p><strong>MDS3_off_total</strong> : increasing score from 0 to 132,</p></li>
<li><p><strong>SCOPA_total</strong> : increasing score from 0 to 72,</p></li>
<li><p><strong>MOCA_total</strong> : decreasing score from 30 to 0,</p></li>
<li><p><strong>AGD_total</strong> : unknown positive score (will need to be explored),</p></li>
<li><p><strong>Others</strong> : the rest are imaging increasing score and then have no border, except that they are suppose to be positive.</p></li>
</ul>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 3 ğŸ’¬</span> <strong>Plot histogram to check that the data are as expected.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="n">df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/bd735ac22482b92edd20761f462b73402e44f500f93be0d8ec1cf477036be3f4.png" src="../../../_images/bd735ac22482b92edd20761f462b73402e44f500f93be0d8ec1cf477036be3f4.png" />
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 4 ğŸ’¬</span> <strong>Check that the variables respect the constraints. How can you interpret those unexpected datas ?</strong></p>
<p>Your answer: â€¦</p>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 5 ğŸ’¬</span> <strong>Apply the right pre-processing to those unexpected data. Do not forget to apply it on ALL the data.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">df_vis</span> <span class="o">=</span> <span class="n">df_vis</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><span style='color: #015e75; font-weight: 600;'>â„¹ï¸ Information â„¹ï¸</span> Leaspy model is able to handle NaN, but it is always important to quantify them.</p>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 6 ğŸ’¬</span> <strong>Return the number of NaN by feature.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MDS1_total        596
MDS2_total          0
MDS3_off_total    196
SCOPA_total         0
MOCA_total          0
PUTAMEN_R           0
PUTAMEN_L           0
CAUDATE_R           0
CAUDATE_L           0
AGD_total           0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p><span style='color: #015e75; font-weight: 600;'>â„¹ï¸ Information â„¹ï¸</span> Leaspy model only takes normalised increasing with time data.</p>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 7 ğŸ’¬</span> <strong>Using the functions below, explore AGD_total to try to understand its progression and compare it to other features.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_individuals</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span>  <span class="n">sublist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">sublist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sublist</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span>
        
    <span class="n">colors</span> <span class="o">=</span>  <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="s1">&#39;icefire&#39;</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sublist</span><span class="p">),</span> <span class="n">desat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">sublist</span><span class="p">):</span>
        <span class="n">indiv_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        
        <span class="n">ages</span> <span class="o">=</span> <span class="n">indiv_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">real_values</span> <span class="o">=</span> <span class="n">indiv_df</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">real_values</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Age in years&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Evolution for each patient of &quot;</span> <span class="o">+</span> <span class="n">feature</span><span class="p">)</span>
        
        
<span class="k">def</span> <span class="nf">individual_linear_regression_against_time</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
    
    <span class="c1"># individual linear regressions on each feature, to study individual progression (with linear regression against age)</span>
    <span class="n">lin_reg_on_frame_time_y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;slope&#39;</span><span class="p">,</span><span class="s1">&#39;intercept&#39;</span><span class="p">,</span><span class="s1">&#39;correl_coef&#39;</span><span class="p">,</span><span class="s1">&#39;pval&#39;</span><span class="p">,</span><span class="s1">&#39;stderr&#39;</span><span class="p">,</span><span class="s1">&#39;intercept_stderr&#39;</span><span class="p">],</span> 
                                                        <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">values</span><span class="p">))))</span>
    
    
    <span class="c1"># select individuals with at least 3 visits</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">nb_visits_with_data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nb_visits_with_data</span><span class="p">[</span><span class="n">nb_visits_with_data</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">lin_reg_on_frame_time_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="n">plot_individuals</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;AGD_total&quot;</span><span class="p">,</span> <span class="n">sublist</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)[:</span><span class="mi">8</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ft_name</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    
    <span class="n">ilr_ft</span> <span class="o">=</span> <span class="n">individual_linear_regression_against_time</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ft_name</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">ilr_ft</span><span class="p">[[</span><span class="s1">&#39;slope&#39;</span><span class="p">,</span><span class="s1">&#39;correl_coef&#39;</span><span class="p">,</span> <span class="s1">&#39;pval&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">ft_name</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ft_name</span><span class="si">}</span><span class="s2">: linear correlation coefficient with time = &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ilr_ft</span><span class="p">[</span><span class="s1">&#39;correl_coef&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">ilr_ft</span><span class="p">[</span><span class="s1">&#39;correl_coef&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/d53359c3b24e9b2d76eb77f2ff61d639abfcc515c95588f28070066891dabfa9.png" src="../../../_images/d53359c3b24e9b2d76eb77f2ff61d639abfcc515c95588f28070066891dabfa9.png" />
<img alt="../../../_images/6bd0f006f1505e1f3f76dd5ecd63fe3eea234033d8ff7103508f47992353d986.png" src="../../../_images/6bd0f006f1505e1f3f76dd5ecd63fe3eea234033d8ff7103508f47992353d986.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MDS1_total: linear correlation coefficient with time = 0.36 Â± 0.45
</pre></div>
</div>
<img alt="../../../_images/a4bca9e6a4ab0c653cd1d1cbabcb41f8c21b405bd676b185b217c3943143ca3b.png" src="../../../_images/a4bca9e6a4ab0c653cd1d1cbabcb41f8c21b405bd676b185b217c3943143ca3b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MDS2_total: linear correlation coefficient with time = 0.37 Â± 0.42
</pre></div>
</div>
<img alt="../../../_images/0d8bff4371575b8ddc77902851e6521dfe1256e66769d0cb5fcb84e7f342e241.png" src="../../../_images/0d8bff4371575b8ddc77902851e6521dfe1256e66769d0cb5fcb84e7f342e241.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MDS3_off_total: linear correlation coefficient with time = 0.35 Â± 0.37
</pre></div>
</div>
<img alt="../../../_images/f4e90225ed55e6705567cf37f03f95730b5e7868c72a64ae7d6293d981ba246c.png" src="../../../_images/f4e90225ed55e6705567cf37f03f95730b5e7868c72a64ae7d6293d981ba246c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCOPA_total: linear correlation coefficient with time = 0.08 Â± 0.40
</pre></div>
</div>
<img alt="../../../_images/89f4c2d8024a649ecef421210ae26ede635faaf8f38e210fca70485747934cbd.png" src="../../../_images/89f4c2d8024a649ecef421210ae26ede635faaf8f38e210fca70485747934cbd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MOCA_total: linear correlation coefficient with time = -0.20 Â± 0.39
</pre></div>
</div>
<img alt="../../../_images/a117bf9a18100e31ab807d67dccd75ae8912c6e38083399857a2dc095692553f.png" src="../../../_images/a117bf9a18100e31ab807d67dccd75ae8912c6e38083399857a2dc095692553f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PUTAMEN_R: linear correlation coefficient with time = 0.44 Â± 0.37
</pre></div>
</div>
<img alt="../../../_images/2a03e55e60ec2ed003588a7e63dfec836155e2b2d017540de3ad72c8aa7577cf.png" src="../../../_images/2a03e55e60ec2ed003588a7e63dfec836155e2b2d017540de3ad72c8aa7577cf.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PUTAMEN_L: linear correlation coefficient with time = 0.48 Â± 0.35
</pre></div>
</div>
<img alt="../../../_images/68290d7b9d9a4d4e8b11fd11569070f38212da40a117ab9f8b1c7ea1137b19e6.png" src="../../../_images/68290d7b9d9a4d4e8b11fd11569070f38212da40a117ab9f8b1c7ea1137b19e6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CAUDATE_R: linear correlation coefficient with time = 0.53 Â± 0.35
</pre></div>
</div>
<img alt="../../../_images/c7d0d811b930c298cb4b7f1143a03f1886de0104b585310e3fbd57f469f1f9e6.png" src="../../../_images/c7d0d811b930c298cb4b7f1143a03f1886de0104b585310e3fbd57f469f1f9e6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CAUDATE_L: linear correlation coefficient with time = 0.54 Â± 0.36
</pre></div>
</div>
<img alt="../../../_images/9b3d35800c456a4b1df2ea01285ef63382029272ce1af6ec64f83c19e5c90b64.png" src="../../../_images/9b3d35800c456a4b1df2ea01285ef63382029272ce1af6ec64f83c19e5c90b64.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AGD_total: linear correlation coefficient with time = 0.09 Â± 0.44
</pre></div>
</div>
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 8 ğŸ’¬</span> <strong>What do you conclude about AGD_total progression? Should we consider it for longitudinal modeling?</strong></p>
<p>Your answer: â€¦</p>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 9 ğŸ’¬</span> <strong>Now that you know the progression of all the features, can you normalize them all now? If not what is the issue and which features are concerned?</strong></p>
<p>Your answer: â€¦</p>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 10 ğŸ’¬</span> <strong>Run the code below to split the data into a training and testing set.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##CREATE TRAINING AND TESTING SETS</span>
<span class="n">patient_stop</span> <span class="o">=</span> <span class="s1">&#39;GS-100&#39;</span>
<span class="n">patient_start</span> <span class="o">=</span> <span class="s1">&#39;GS-101&#39;</span>

<span class="n">df_train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">patient_stop</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">patient_start</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_to_pred</span> <span class="o">=</span> <span class="n">df_vis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">patient_start</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 11 ğŸ’¬</span> <strong>Normalize the data using the function below and making sure that you have increasing data at the end.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">feat</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">increase</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">):</span>
    <span class="n">df_study</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_study</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_study</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">increase</span> <span class="p">:</span>
        <span class="n">df_study</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df_study</span>
    <span class="k">return</span> <span class="n">df_study</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="c1"># bounded scores</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;MDS1_total&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="c1"># max, min, increase?</span>
    <span class="s2">&quot;MDS2_total&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="s2">&quot;MDS3_off_total&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">132</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="s2">&quot;SCOPA_total&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="s2">&quot;MOCA_total&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
    <span class="c1">#&quot;AGD_total&quot;: #No need we will not use it...</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">score_name</span><span class="p">,</span> <span class="n">normalize_args</span> <span class="ow">in</span> <span class="n">scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">df_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">score_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">score_name</span><span class="p">,</span> <span class="o">*</span><span class="n">normalize_args</span> <span class="p">)</span>
    <span class="n">df_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">score_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">df_test</span><span class="p">,</span> <span class="n">score_name</span><span class="p">,</span> <span class="o">*</span><span class="n">normalize_args</span> <span class="p">)</span>
    <span class="n">df_to_pred</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">score_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">df_to_pred</span><span class="p">,</span> <span class="n">score_name</span><span class="p">,</span> <span class="o">*</span><span class="n">normalize_args</span> <span class="p">)</span>

<span class="c1"># imagery (all features are increasing)</span>
<span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PUTAMEN_R&#39;</span><span class="p">,</span> <span class="s1">&#39;PUTAMEN_L&#39;</span><span class="p">,</span> <span class="s1">&#39;CAUDATE_R&#39;</span><span class="p">,</span> <span class="s1">&#39;CAUDATE_L&#39;</span><span class="p">]:</span>
    
    <span class="n">df_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">df_test</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">df_train</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> 
                                         <span class="n">df_train</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">increase</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="i-2-train-your-model">
<h3>I.2. Train your model<a class="headerlink" href="#i-2-train-your-model" title="Permalink to this heading">#</a></h3>
<p><span style='color: #015e75; font-weight: 600;'>â„¹ï¸ Information â„¹ï¸</span> Be carefull you have only an <strong>hour and half</strong> and running a leaspy model on ten features can take a lot of timeâ€¦ We advise you to start by univariate model â€¦</p>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 12 ğŸ’¬</span> <strong>Complete the code below to select the columns you want to use to train your leaspy model.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>

<span class="n">col</span> <span class="o">=</span> <span class="c1">#####################################</span>

<span class="n">data_train</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> 
<span class="n">data_test</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<span class="n">df_to_pred</span> <span class="o">=</span> <span class="n">df_to_pred</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MDS3_off_total&quot;</span><span class="p">,</span> <span class="s2">&quot;MDS2_total&quot;</span><span class="p">]</span>

<span class="n">data_train</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> 
<span class="n">data_test</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<span class="n">df_to_pred</span> <span class="o">=</span> <span class="n">df_to_pred</span>
</pre></div>
</div>
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 13 ğŸ’¬</span> <strong>Complete the code below to set the parameters you want for your model.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>

<span class="n">leaspy_model</span> <span class="o">=</span> <span class="c1">###############</span>
<span class="n">nb_source</span> <span class="o">=</span> <span class="c1">###############</span>
<span class="n">algo_settings</span> <span class="o">=</span> <span class="c1">#################</span>

<span class="n">algo_settings</span><span class="o">.</span><span class="n">set_logs</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span> 
    <span class="n">console_print_periodicity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># If = N, it display logs in the console/terminal every N iterations</span>
    <span class="n">overwrite_logs_folder</span><span class="o">=</span><span class="kc">True</span>       <span class="c1"># Default behaviour raise an error if the folder already exists.</span>
<span class="p">)</span>

<span class="c1">##FIT</span>
<span class="n">leaspy</span> <span class="o">=</span> <span class="n">Leaspy</span><span class="p">(</span><span class="n">leaspy_model</span><span class="p">)</span>
<span class="n">leaspy</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_hyperparameters</span><span class="p">({</span><span class="s1">&#39;source_dimension&#39;</span><span class="p">:</span> <span class="n">nb_source</span><span class="p">})</span>
<span class="n">leaspy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span> <span class="n">algorithm_settings</span><span class="o">=</span><span class="n">algo_settings</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="n">leaspy_model</span> <span class="o">=</span> <span class="s2">&quot;logistic&quot;</span> <span class="c1">#&#39;univariate&#39;</span>
<span class="n">nb_source</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">algo_settings</span> <span class="o">=</span> <span class="n">AlgorithmSettings</span><span class="p">(</span><span class="s1">&#39;mcmc_saem&#39;</span><span class="p">,</span> 
                                  <span class="n">n_iter</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>           <span class="c1"># n_iter defines the number of iterations</span>
                                  <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     <span class="c1"># To display a nice progression bar during calibration</span>

<span class="n">algo_settings</span><span class="o">.</span><span class="n">set_logs</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span> 
    <span class="n">console_print_periodicity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># If = N, it display logs in the console/terminal every N iterations</span>
    <span class="n">overwrite_logs_folder</span><span class="o">=</span><span class="kc">True</span>       <span class="c1"># Default behaviour raise an error if the folder already exists.</span>
<span class="p">)</span>

<span class="c1">##FIT</span>
<span class="n">leaspy</span> <span class="o">=</span> <span class="n">Leaspy</span><span class="p">(</span><span class="n">leaspy_model</span><span class="p">)</span>
<span class="n">leaspy</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_hyperparameters</span><span class="p">({</span><span class="s1">&#39;source_dimension&#39;</span><span class="p">:</span> <span class="n">nb_source</span><span class="p">})</span>
<span class="n">leaspy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train</span><span class="p">,</span> <span class="n">algorithm_settings</span><span class="o">=</span><span class="n">algo_settings</span><span class="p">)</span>

<span class="c1">#leaspy = Leaspy.load(&#39;./outputs/model_parameters.json&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>...overwrite logs folder...
|##################################################|   3000/3000 iterations
The standard deviation of the noise at the end of the calibration is:
0.0582

Calibration took: 2min 48s
</pre></div>
</div>
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 14 ğŸ’¬</span> <strong>Evaluate that your model learned well and then save it.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="c1"># Check the logs, the noise std, coherence of model parameters, ...</span>

<span class="n">leaspy</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;./outputs/model_parameters.json&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">leaspy</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">IFrame</span><span class="p">(</span><span class="s1">&#39;./logs/plots/convergence_1.pdf&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">670</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;g&#39;: tensor([0.9264, 1.3880]), &#39;v0&#39;: tensor([-4.4238, -4.1641]), &#39;betas&#39;: tensor([[-0.0449]]), &#39;tau_mean&#39;: tensor(71.3112), &#39;tau_std&#39;: tensor(10.0713), &#39;xi_mean&#39;: tensor(0.), &#39;xi_std&#39;: tensor(0.6131), &#39;sources_mean&#39;: tensor(0.), &#39;sources_std&#39;: tensor(1.), &#39;noise_std&#39;: tensor(0.0582)}
</pre></div>
</div>
<div class="output text_html">
        <iframe
            width="990"
            height="670"
            src="./logs/plots/convergence_1.pdf"
            frameborder="0"
            allowfullscreen
        ></iframe>
        </div></div>
</div>
</div>
<div class="section" id="i-3-test-your-model">
<h3>I.3. Test your model<a class="headerlink" href="#i-3-test-your-model" title="Permalink to this heading">#</a></h3>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 15 ğŸ’¬</span> <strong>Complete the code below to make the predictions.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>

<span class="c1">##SET PARAMETERS</span>
<span class="n">settings_personalization</span> <span class="o">=</span> <span class="c1">#################</span>

<span class="c1">##PREDICTIONS</span>
<span class="n">ip</span> <span class="o">=</span> <span class="c1">#################</span>
<span class="n">reconstruction</span> <span class="o">=</span> <span class="c1">#################</span>
<span class="n">d2</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reconstruction</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">df_pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="s2">&quot;_model1&quot;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="c1">##SET PARAMETERS</span>
<span class="n">settings_personalization</span> <span class="o">=</span> <span class="n">AlgorithmSettings</span><span class="p">(</span><span class="s1">&#39;scipy_minimize&#39;</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_jacobian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">##PREDICTIONS</span>
<span class="n">ip</span> <span class="o">=</span> <span class="n">leaspy</span><span class="o">.</span><span class="n">personalize</span><span class="p">(</span><span class="n">data_test</span><span class="p">,</span> <span class="n">settings_personalization</span><span class="p">)</span>
<span class="n">reconstruction</span> <span class="o">=</span> <span class="n">leaspy</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_to_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">df_to_pred</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">])),</span> <span class="n">ip</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reconstruction</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">df_pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="s2">&quot;_model1&quot;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|##################################################|   100/100 subjects
The standard deviation of the noise at the end of the personalization is:
0.0567

Personalization scipy_minimize took: 2s
</pre></div>
</div>
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 16 ğŸ’¬</span> <strong>Display results of your prediction against real values and the mean absolute error.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">col</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean absolute error &quot;</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_to_pred</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">-</span><span class="n">df_pred</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="s1">&#39;_model1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_to_pred</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">df_pred</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="s1">&#39;_model1&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Real value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean absolute error MDS3_off_total : 0.059690863332327676
</pre></div>
</div>
<img alt="../../../_images/675902bc35e604e08ba2322f9ed4fd57eabd295d753b3367a80649703f64c9e1.png" src="../../../_images/675902bc35e604e08ba2322f9ed4fd57eabd295d753b3367a80649703f64c9e1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean absolute error MDS2_total : 0.05356992930173874
</pre></div>
</div>
<img alt="../../../_images/bc35779c52e518593204924335231db99859a65dd73cb3261a23ca2bba1addda.png" src="../../../_images/bc35779c52e518593204924335231db99859a65dd73cb3261a23ca2bba1addda.png" />
</div>
</div>
<p><span style='color: #015e75; font-weight: 600;'>â„¹ï¸ Information â„¹ï¸</span> Note that an average good error is about 5% of absolute error for MDS3_off_total.</p>
</div>
</div>
<div class="section" id="part-ii-the-cofactor-evaluation">
<h2>Part II: The cofactor evaluation<a class="headerlink" href="#part-ii-the-cofactor-evaluation" title="Permalink to this heading">#</a></h2>
<p>Besides prediction, the individual parameters are interesting in the sense that they provide meaningful and interesting insights about the disease progression. For that reasons, these individual parameters can be correlated to other cofactors. Letâ€™s consider that you have a covariate Cofactor 1 that encodes a genetic status: 1 if a specific mutation is present, 0 otherwise. Now, letâ€™s see if this mutation has an effect on the disease progression.</p>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 17 ğŸ’¬</span> <strong>Complete the code below to see the repartition of carriers and non carriers.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># â€”â€” Convert individual parameters to dataframe</span>
<span class="n">df_ip</span> <span class="o">=</span> <span class="c1">###############</span>

<span class="c1"># â€”â€” Join the cofactors to individual parameters</span>
<span class="n">cofactor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;cof_leaspy2.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span>
<span class="n">df_ip</span> <span class="o">=</span> <span class="n">df_ip</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cofactor</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;MUTATION&#39;</span><span class="p">:{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Non-carrier&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Carrier&#39;</span><span class="p">}}))</span>

<span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># â€”â€” Plot the time shifts in carriers and non-carriers</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time shift histogram&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_ip</span><span class="p">,</span> <span class="n">x</span><span class="o">=...</span><span class="p">,</span> <span class="n">hue</span><span class="o">=...</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># â€”â€” Plot the acceleration factor in carriers and non-carriers</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Log-Acceleration factor histogram&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_ip</span><span class="p">,</span> <span class="n">x</span><span class="o">=...</span><span class="p">,</span> <span class="n">hue</span><span class="o">=...</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># __ Joint density (tau, xi) __</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=...</span><span class="p">,</span> <span class="n">x</span><span class="o">=...</span><span class="p">,</span> <span class="n">y</span><span class="o">=...</span><span class="p">,</span> <span class="n">hue</span><span class="o">=...</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bw_adjust</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>

<span class="c1"># __ Nb of mutated patients ___</span>
<span class="n">df_ip</span><span class="p">[</span><span class="s1">&#39;MUTATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># â€”â€” Convert individual parameters to dataframe</span>
<span class="n">df_ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>

<span class="c1"># â€”â€” Join the cofactors to individual parameters</span>
<span class="n">cofactor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span> <span class="o">+</span> <span class="s2">&quot;cof_leaspy2.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span>
<span class="n">df_ip</span> <span class="o">=</span> <span class="n">df_ip</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cofactor</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;MUTATION&#39;</span><span class="p">:{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Non-carrier&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Carrier&#39;</span><span class="p">}}))</span>

<span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># â€”â€” Plot the time shifts in carriers and non-carriers</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time shift histogram&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_ip</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;MUTATION&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># â€”â€” Plot the acceleration factor in carriers and non-carriers</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Log-Acceleration factor histogram&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_ip</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;xi&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;MUTATION&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># __ Joint density (tau, xi) __</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_ip</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;xi&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;MUTATION&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bw_adjust</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span>

<span class="c1"># __ Nb of mutated patients ___</span>
<span class="n">df_ip</span><span class="p">[</span><span class="s1">&#39;MUTATION&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2c974e5538cf9196cff076439d0f7cd8bcf1d106a674fccf26dc81845cc3f341.png" src="../../../_images/2c974e5538cf9196cff076439d0f7cd8bcf1d106a674fccf26dc81845cc3f341.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Non-carrier    71
Carrier        29
Name: MUTATION, dtype: int64
</pre></div>
</div>
<img alt="../../../_images/c05c734fc208f8bce4940c263c733334a47cccfbb85177943c8868eb004693d3.png" src="../../../_images/c05c734fc208f8bce4940c263c733334a47cccfbb85177943c8868eb004693d3.png" />
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 18 ğŸ’¬</span> <strong>Make a statistic tests using <code class="docutils literal notranslate"><span class="pre">stats.ttest_ind</span></code> and <code class="docutils literal notranslate"><span class="pre">stats.mannwhitneyu</span></code>.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="n">carriers</span> <span class="o">=</span> <span class="n">df_ip</span><span class="p">[</span><span class="n">df_ip</span><span class="p">[</span><span class="s1">&#39;MUTATION&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Carrier&#39;</span><span class="p">]</span>
<span class="n">non_carriers</span> <span class="o">=</span> <span class="n">df_ip</span><span class="p">[</span><span class="n">df_ip</span><span class="p">[</span><span class="s1">&#39;MUTATION&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Non-carrier&#39;</span><span class="p">]</span>

<span class="c1"># â€”â€” Student t-test (under the asumption of a gaussian distribution only)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">carriers</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">],</span> <span class="n">non_carriers</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">carriers</span><span class="p">[</span><span class="s1">&#39;xi&#39;</span><span class="p">],</span> <span class="n">non_carriers</span><span class="p">[</span><span class="s1">&#39;xi&#39;</span><span class="p">]))</span>

<span class="c1"># â€”â€” Mann-withney t-test</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">carriers</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">],</span> <span class="n">non_carriers</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">carriers</span><span class="p">[</span><span class="s1">&#39;xi&#39;</span><span class="p">],</span> <span class="n">non_carriers</span><span class="p">[</span><span class="s1">&#39;xi&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_indResult(statistic=6.116870627752805, pvalue=1.958990326701787e-08)
Ttest_indResult(statistic=-2.9131535065482375, pvalue=0.004431884326689646)
MannwhitneyuResult(statistic=301.0, pvalue=1.6002231482727975e-08)
MannwhitneyuResult(statistic=662.0, pvalue=0.0026530380825654097)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="part-iii-univariate-vs-multivariate">
<h2>Part III: Univariate vs Multivariate<a class="headerlink" href="#part-iii-univariate-vs-multivariate" title="Permalink to this heading">#</a></h2>
<p>Now that you have a multivariate model that works, letâ€™s compare the multivariate and univariate model. For that you will compare a multivariate model with MDS3 and MDS2 with two univariate model MDS2 and MDS3 separatly.</p>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 19 ğŸ’¬</span> <strong>Fit 3 models, one multivariate and two univariate with MDS2 and MDS3.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>

<span class="n">leaspy_model_u</span> <span class="o">=</span> <span class="c1">###########################</span>
<span class="n">leaspy_model</span> <span class="o">=</span> <span class="c1">###########################</span>
<span class="n">algo_settings</span> <span class="o">=</span> <span class="c1">###########################</span>

<span class="c1">#With MDS2 and MDS3</span>
<span class="n">data_train23</span> <span class="o">=</span> <span class="c1">###########################</span>
<span class="n">data_test23</span> <span class="o">=</span> <span class="c1">###########################</span>

<span class="n">leaspy23</span> <span class="o">=</span> <span class="c1">#########</span>
<span class="c1">###########################</span>

<span class="c1">#With MDS3</span>
<span class="n">data_train3</span> <span class="o">=</span> <span class="c1">##################</span>
<span class="n">data_test3</span> <span class="o">=</span> <span class="c1">##################</span>

<span class="n">leaspy3</span> <span class="o">=</span> <span class="c1">##################</span>
<span class="c1">##################</span>

<span class="c1">#With MDS2</span>

<span class="c1">##########################</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="n">leaspy_model_u</span> <span class="o">=</span> <span class="s1">&#39;univariate_logistic&#39;</span>
<span class="n">leaspy_model</span> <span class="o">=</span> <span class="s2">&quot;logistic&quot;</span> <span class="c1">#&#39;univariate&#39;</span>
<span class="n">algo_settings</span> <span class="o">=</span> <span class="n">AlgorithmSettings</span><span class="p">(</span><span class="s1">&#39;mcmc_saem&#39;</span><span class="p">,</span> 
                                  <span class="n">n_iter</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>           <span class="c1"># n_iter defines the number of iterations</span>
                                  <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     <span class="c1"># To display a nice progression bar during calibration</span>

<span class="c1">#algo_settings.set_logs(path=...)</span>

<span class="c1">#With MDS2 and MDS3</span>
<span class="n">data_train23</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_train</span><span class="p">[[</span><span class="s2">&quot;MDS3_off_total&quot;</span><span class="p">,</span> <span class="s2">&quot;MDS2_total&quot;</span><span class="p">]])</span> 
<span class="n">data_test23</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_test</span><span class="p">[[</span><span class="s2">&quot;MDS3_off_total&quot;</span><span class="p">,</span> <span class="s2">&quot;MDS2_total&quot;</span><span class="p">]])</span>

<span class="n">leaspy23</span> <span class="o">=</span> <span class="n">Leaspy</span><span class="p">(</span><span class="n">leaspy_model</span><span class="p">)</span>
<span class="n">leaspy23</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train23</span><span class="p">,</span> <span class="n">algorithm_settings</span><span class="o">=</span><span class="n">algo_settings</span><span class="p">)</span>
<span class="n">leaspy23</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;./outputs/model_parameters_23.json&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#With MDS3</span>
<span class="n">data_train3</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_train</span><span class="p">[[</span><span class="s2">&quot;MDS3_off_total&quot;</span><span class="p">]])</span> 
<span class="n">data_test3</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_test</span><span class="p">[[</span><span class="s2">&quot;MDS3_off_total&quot;</span><span class="p">]])</span>

<span class="n">leaspy3</span> <span class="o">=</span> <span class="n">Leaspy</span><span class="p">(</span><span class="n">leaspy_model_u</span><span class="p">)</span>
<span class="n">leaspy3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train3</span><span class="p">,</span> <span class="n">algorithm_settings</span><span class="o">=</span><span class="n">algo_settings</span><span class="p">)</span>
<span class="n">leaspy3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;./outputs/model_parameters_3.json&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#With MDS2</span>
<span class="n">data_train2</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_train</span><span class="p">[[</span><span class="s2">&quot;MDS2_total&quot;</span><span class="p">]])</span> 
<span class="n">data_test2</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df_test</span><span class="p">[[</span><span class="s2">&quot;MDS2_total&quot;</span><span class="p">]])</span>

<span class="n">leaspy2</span> <span class="o">=</span> <span class="n">Leaspy</span><span class="p">(</span><span class="n">leaspy_model_u</span><span class="p">)</span>
<span class="n">leaspy2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_train3</span><span class="p">,</span> <span class="n">algorithm_settings</span><span class="o">=</span><span class="n">algo_settings</span><span class="p">)</span>
<span class="n">leaspy2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;./outputs/model_parameters_2.json&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|##################################################|   3000/3000 iterations
The standard deviation of the noise at the end of the calibration is:
0.0583

Calibration took: 53s
|##################################################|   3000/3000 iterations
The standard deviation of the noise at the end of the calibration is:
0.0661

Calibration took: 12s
|##################################################|   3000/3000 iterations
The standard deviation of the noise at the end of the calibration is:
0.0669

Calibration took: 9s
</pre></div>
</div>
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 20 ğŸ’¬</span> <strong>Make the predictions for each model.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>

<span class="c1">##SET PARAMETERS</span>
<span class="n">settings_personalization</span> <span class="o">=</span> <span class="c1">#############################</span>

<span class="c1">##PREDICTIONS MDS3</span>
<span class="n">ip23</span> <span class="o">=</span> <span class="c1">#############################</span>
<span class="n">reconstruction23</span> <span class="o">=</span> <span class="n">leaspy23</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_to_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">df_to_pred</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">])),</span> <span class="n">ip23</span><span class="p">)</span>
<span class="n">d223</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reconstruction23</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">df_pred23</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d223</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MDS3_off_total_model_m&quot;</span><span class="p">,</span> <span class="s2">&quot;MDS2_total_model_m&quot;</span><span class="p">])</span>

<span class="c1">##PREDICTIONS MDS3</span>
<span class="n">ip3</span> <span class="o">=</span> <span class="c1">#############################</span>
<span class="n">reconstruction3</span> <span class="o">=</span> <span class="n">leaspy3</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_to_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">df_to_pred</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">])),</span> <span class="n">ip3</span><span class="p">)</span>
<span class="n">d23</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reconstruction3</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">df_pred3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d23</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MDS3_off_total_model_u&quot;</span><span class="p">])</span>

<span class="c1">##PREDICTIONS MDS3</span>
<span class="c1">#############################</span>

<span class="c1">#CONCATE PREDICTIONS</span>
<span class="n">df_pred_mu</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_pred23</span><span class="p">,</span> <span class="n">df_pred3</span><span class="p">,</span> <span class="n">df_pred2</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>

<span class="c1">##SET PARAMETERS</span>
<span class="n">settings_personalization</span> <span class="o">=</span> <span class="n">AlgorithmSettings</span><span class="p">(</span><span class="s1">&#39;scipy_minimize&#39;</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_jacobian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">##PREDICTIONS MDS3</span>
<span class="n">ip23</span> <span class="o">=</span> <span class="n">leaspy23</span><span class="o">.</span><span class="n">personalize</span><span class="p">(</span><span class="n">data_test23</span><span class="p">,</span> <span class="n">settings_personalization</span><span class="p">)</span>
<span class="n">reconstruction23</span> <span class="o">=</span> <span class="n">leaspy23</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_to_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">df_to_pred</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">])),</span> <span class="n">ip23</span><span class="p">)</span>
<span class="n">d223</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reconstruction23</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">df_pred23</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d223</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MDS3_off_total_model_m&quot;</span><span class="p">,</span> <span class="s2">&quot;MDS2_total_model_m&quot;</span><span class="p">])</span>

<span class="c1">##PREDICTIONS MDS3</span>
<span class="n">ip3</span> <span class="o">=</span> <span class="n">leaspy3</span><span class="o">.</span><span class="n">personalize</span><span class="p">(</span><span class="n">data_test3</span><span class="p">,</span> <span class="n">settings_personalization</span><span class="p">)</span>
<span class="n">reconstruction3</span> <span class="o">=</span> <span class="n">leaspy3</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_to_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">df_to_pred</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">])),</span> <span class="n">ip3</span><span class="p">)</span>
<span class="n">d23</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reconstruction3</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">df_pred3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d23</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MDS3_off_total_model_u&quot;</span><span class="p">])</span>

<span class="c1">##PREDICTIONS MDS3</span>
<span class="n">ip2</span> <span class="o">=</span> <span class="n">leaspy2</span><span class="o">.</span><span class="n">personalize</span><span class="p">(</span><span class="n">data_test2</span><span class="p">,</span> <span class="n">settings_personalization</span><span class="p">)</span>
<span class="n">reconstruction2</span> <span class="o">=</span> <span class="n">leaspy2</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_to_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">df_to_pred</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">])),</span> <span class="n">ip2</span><span class="p">)</span>
<span class="n">d22</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reconstruction2</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">df_pred2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">d22</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MDS2_total_model_u&quot;</span><span class="p">])</span>

<span class="c1">#CONCATE PREDICTIONS</span>
<span class="n">df_pred_mu</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_pred23</span><span class="p">,</span> <span class="n">df_pred3</span><span class="p">,</span> <span class="n">df_pred2</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|##################################################|   100/100 subjects
The standard deviation of the noise at the end of the personalization is:
0.0569

Personalization scipy_minimize took: 3s
|##################################################|   100/100 subjects
The standard deviation of the noise at the end of the personalization is:
0.0687

Personalization scipy_minimize took: 1s
|##################################################|   100/100 subjects
The standard deviation of the noise at the end of the personalization is:
0.0707

Personalization scipy_minimize took: 1s
</pre></div>
</div>
</div>
</div>
<p><span style='color: #a13203; font-weight: 600;'>ğŸ’¬ Question 21 ğŸ’¬</span> <strong>Display results of predictions against real values and the mean absolute error.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To complete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“ Answer â€“â€“â€“â€“ #</span>
<span class="c1"># â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ #</span>
<span class="n">col_plot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MDS3_off_total_model_m&#39;</span><span class="p">,</span> <span class="s1">&#39;MDS3_off_total_model_u&#39;</span><span class="p">,</span> <span class="s1">&#39;MDS2_total_model_m&#39;</span><span class="p">,</span> <span class="s1">&#39;MDS2_total_model_u&#39;</span><span class="p">]</span>
<span class="n">col_real</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MDS3_off_total&#39;</span><span class="p">,</span> <span class="s1">&#39;MDS3_off_total&#39;</span><span class="p">,</span><span class="s1">&#39;MDS2_total&#39;</span><span class="p">,</span> <span class="s1">&#39;MDS2_total&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_plot</span><span class="p">))</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean absolute error &quot;</span><span class="o">+</span><span class="n">col_plot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_to_pred</span><span class="p">[</span><span class="n">col_real</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">-</span><span class="n">df_pred_mu</span><span class="p">[</span><span class="n">col_plot</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_to_pred</span><span class="p">[</span><span class="n">col_real</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">df_pred_mu</span><span class="p">[</span><span class="n">col_plot</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">col_plot</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Real value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean absolute error MDS3_off_total_model_m : 0.05958525082644294
</pre></div>
</div>
<img alt="../../../_images/dda797ba72e6394cebe67b35a23ee4e76340f1f2a0f3d49d958e3583a395561e.png" src="../../../_images/dda797ba72e6394cebe67b35a23ee4e76340f1f2a0f3d49d958e3583a395561e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean absolute error MDS3_off_total_model_u : 0.06501929260352078
</pre></div>
</div>
<img alt="../../../_images/0eb094a8e8ddd60939b1f97eefbd1cf48cc4708e1f31d164a1dfcccace0e77a2.png" src="../../../_images/0eb094a8e8ddd60939b1f97eefbd1cf48cc4708e1f31d164a1dfcccace0e77a2.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean absolute error MDS2_total_model_m : 0.05325222294777632
</pre></div>
</div>
<img alt="../../../_images/ba7dae6db70c921cdc1ea8608b6646f8c0d94b36103549e347ac0893f18e6640.png" src="../../../_images/ba7dae6db70c921cdc1ea8608b6646f8c0d94b36103549e347ac0893f18e6640.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean absolute error MDS2_total_model_u : 0.0676489770412445
</pre></div>
</div>
<img alt="../../../_images/1ef31185b5a9970e5899effafe6dbccfa32b6c7dd75423a187c6b310191e290a.png" src="../../../_images/1ef31185b5a9970e5899effafe6dbccfa32b6c7dd75423a187c6b310191e290a.png" />
</div>
</div>
</div>
<div class="section" id="part-iv-get-the-best-model-as-you-can">
<h2>Part IV: Get the best model as you can<a class="headerlink" href="#part-iv-get-the-best-model-as-you-can" title="Permalink to this heading">#</a></h2>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./pages/notebooks/disease_course_mapping"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="TP2_leaspy_beginner.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">First steps with Leaspy</p>
      </div>
    </a>
    <a class="right-next"
       href="../non_parametric_DPM/non_parametric_DPM.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">GP Progression Model</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">Objectives :</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-set-up">The set-up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-i-the-prediction">Part I: The prediction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-1-prepare-your-data">I.1. Prepare your data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-2-train-your-model">I.2. Train your model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i-3-test-your-model">I.3. Test your model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-ii-the-cofactor-evaluation">Part II: The cofactor evaluation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-iii-univariate-vs-multivariate">Part III: Univariate vs Multivariate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-iv-get-the-best-model-as-you-can">Part IV: Get the best model as you can</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Disease Progression Modelling community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>